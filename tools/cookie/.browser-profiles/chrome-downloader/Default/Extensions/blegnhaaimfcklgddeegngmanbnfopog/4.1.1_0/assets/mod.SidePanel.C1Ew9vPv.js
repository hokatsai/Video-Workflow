import{O as F,S as $,G as R,H as X,u as G,a as V,J as Z,K as q,_ as W,V as c,M as x,C as Q,g as K,E as j}from"./idx.index.SBXPcqgv.js";import{v as J}from"./mod.uuid.CtRu48qb.js";import{j as Y,r as p,D as tt,q as L,z as H,v as P,y as i,A as k,F as et,N as d,a5 as it,R as f,S as m,a6 as st,B as nt,C as v,L as at}from"./mod.vue.T5czO8QZ.js";import"./mod.pinia.X_A9LvIF.js";import"./mod.canvas.D6-XlEtG.js";import"./mod.vuetify.Cqpg4kqI.js";import"./mod.mitt.DJ65BbbF.js";import"./mod.vue3tour.CwYx1CjT.js";import"./mod.vuerouter.CKJFEFIr.js";import"./mod.jsmd5.B6W_seTK.js";function y(e,t){return U[e]&&U[e](t)}const ot=e=>{const t=J();return{type:"COPILOT_CHAT_START",data:{id:t,messageId:t,text:e.text,type:0,file_ids:[],command:{type:e.type,data:{}}}}},lt=e=>({type:"COPILOT_INPUTBOX_TEXT_QUOTE",data:{action:"replace",text:e}}),rt=e=>({type:"COPILOT_INPUTBOX_FILL",data:{files:[e]}}),dt=e=>({type:"COPILOT_CONFIG",data:{sidebarDisabled:!0,headerNewSessionDisabled:!1,banner:{title:"灵犀AI",description:"开启网页问答"},trackingConfig:{sub_position:e}}}),U={COPILOT_CHAT_START:ot,COPILOT_INPUTBOX_TEXT_QUOTE:lt,COPILOT_INPUTBOX_FILL:rt,COPILOT_CONFIG:dt},ut={key:0,class:"banner"},ct={class:"dialog"},pt=["src"],ft={class:"main"},mt={class:"title"},gt={class:"content"},vt={class:"btn"},ht=Y({__name:"AdBanner",setup(e){const{sendEvent:t}=new F,o=p(""),s=p(""),l=p(""),a=p(0),C=p(0),r=p(""),O=p(""),g=p(""),b=p({}),_=p(!1),S=new $;let M="";function B({count:n}){setTimeout(()=>{S.setItemWithStringify("sidePanelTianCeAdBanner",{showCount:n,lastShowTime:Date.now()}),_.value=!0,t("plugin_event",{action:"show",position:"right_side",element:"popup"})},5e3)}async function z(){const n=await X("AUTOCJ2838");if(!n.result||!n.adBanner)return;o.value=n.adBanner,s.value=n.jumpType,b.value=n.payModal||{},l.value=n.link||"",r.value=n.title||"",a.value=n.total||0,C.value=n.day||0,O.value=n.content||"",g.value=n.button||"好的",M=n.mkKey||"",t("tiance_show",{mk_key:n.mkKey});const T=await S.getItemWithDefault("sidePanelTianCeAdBanner",{lastShowTime:0,showCount:0}),N=Date.now()-T.lastShowTime<C.value*24*60*60*1e3;N&&T.showCount<a.value?B({count:T.showCount+1}):!N&&a.value>0&&B({count:1})}function D(){const{isLogin:n}=G();if(!n){V.login();return}s.value==="link"?Z.createTab({active:!0,url:l.value}):s.value==="payModal"&&q("PAY",{...b.value}),_.value=!1,t("plugin_event",{action:"click",position:"right_side",element:"button"}),t("tiance_click",{mk_key:M})}function E(){_.value=!1,t("plugin_event",{action:"click",position:"right_side",element:"cancel"})}return tt(()=>{z()}),(n,T)=>_.value?(P(),L("div",ut,[i("div",ct,[i("div",{class:"close",onClick:E},T[0]||(T[0]=[i("img",{class:"close_img",src:R,alt:"关闭"},null,-1)])),i("img",{class:"icon",src:o.value,alt:""},null,8,pt),i("div",ft,[i("div",mt,k(r.value),1),i("div",gt,k(O.value),1),i("div",vt,[i("div",{class:"btnGroup ok",onClick:D},[i("span",null,k(g.value),1)]),i("div",{class:"btnGroup cancel",onClick:E},"取消")])])])])):H("",!0)}}),Ct=W(ht,[["__scopeId","data-v-a18ecc2c"]]),_t="data:image/svg+xml,%3csvg%20width='100'%20height='100'%20viewBox='0%200%20100%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20opacity='0.4'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M59.3374%2017.4937C55.032%2010.5802%2044.968%2010.5802%2040.6626%2017.4937L8.47153%2069.1851C3.90851%2076.5122%209.17711%2086%2017.8089%2086H82.191C90.8228%2086%2096.0914%2076.5122%2091.5284%2069.1851L59.3374%2017.4937ZM53.3711%2023.7785C51.7983%2021.3158%2048.2016%2021.3158%2046.6288%2023.7785L15.9296%2071.847C14.2291%2074.5096%2016.1415%2078%2019.3008%2078H80.6992C83.8585%2078%2085.7708%2074.5096%2084.0703%2071.847L53.3711%2023.7785Z'%20fill='%23E5E3FA'/%3e%3cpath%20opacity='0.4'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M53.3712%2023.7784C51.7984%2021.3157%2048.2017%2021.3157%2046.6289%2023.7784L15.9297%2071.8469C14.2292%2074.5095%2016.1415%2077.9999%2019.3008%2077.9999H80.6992C83.8585%2077.9999%2085.7709%2074.5095%2084.0704%2071.8469L53.3712%2023.7784ZM53.057%2037.0414H48.1061C46.5798%2037.0414%2045.37%2037.9138%2045.4652%2038.9458L47.7805%2058.4544C47.8676%2059.3992%2049.0241%2060.1352%2050.4213%2060.1352H50.7417C52.139%2060.1352%2053.2954%2059.3992%2053.3826%2058.4544L55.6978%2038.9458C55.793%2037.9138%2054.5833%2037.0414%2053.057%2037.0414ZM54.5861%2066.9097C54.5861%2069.1725%2052.7517%2071.007%2050.4889%2071.007C48.226%2071.007%2046.3916%2069.1725%2046.3916%2066.9097C46.3916%2064.6468%2048.226%2062.8124%2050.4889%2062.8124C52.7517%2062.8124%2054.5861%2064.6468%2054.5861%2066.9097Z'%20fill='%23A59CEC'/%3e%3cpath%20opacity='0.9'%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M48.1061%2037.0415H53.057C54.5833%2037.0415%2055.793%2037.9139%2055.6978%2038.9459L53.3826%2058.4545C53.2954%2059.3993%2052.139%2060.1353%2050.7417%2060.1353H50.4213C49.0241%2060.1353%2047.8676%2059.3993%2047.7805%2058.4545L45.4652%2038.9459C45.37%2037.9139%2046.5798%2037.0415%2048.1061%2037.0415ZM50.4889%2071.0071C52.7517%2071.0071%2054.5861%2069.1726%2054.5861%2066.9098C54.5861%2064.6469%2052.7517%2062.8125%2050.4889%2062.8125C48.226%2062.8125%2046.3916%2064.6469%2046.3916%2066.9098C46.3916%2069.1726%2048.226%2071.0071%2050.4889%2071.0071Z'%20fill='white'/%3e%3c/svg%3e",{sendEvent:I}=new F,w=new Q;let h=!0;const A={chat:"/",creative:"/creative",ppt:"/ppt",search:"/search",read:"/read",history:"/history",favorite:"/collection"},Tt={chat:"right_aichat",creative:"right_aiwrite",ppt:"right_aippt",search:"right_aisearch",read:"right_read",history:"right_historychat",favorite:"right_collect"},yt={chat:"sidebar_question",creative:"sidebar_writing",ppt:"sidebar_ppt",search:"sidebar_search",read:"sidebar_read"};let u="https://lingxi.wps.cn";const It=/^https?:\/\/([^.]+\.)*wps\.cn$/,Ot=/^https?:\/\/([^.]+\.)*kdocs\.cn$/,wt={name:"SidePanelView",components:{AdBanner:Ct},computed:{},data(){return{url:"",action:"",showOverlay:!1,isWebpagesum:!1,sub_position:"",lingxi_fail:!1}},methods:{onClick(e,t=!1){if(e==="protal"){w.createTab({url:"https://x.wps.cn?from=sider"}),t&&I("plugin_sidebar",{action:"click",element:"more"});return}this.action=e,this.iframe.contentWindow.postMessage({type:"COPILOT_ROUTER_PUSH",data:A[e]},u),t&&(this.sub_position=yt[e],this.updateSubPosition(this.sub_position),I("plugin_sidebar",{action:"click",element:Tt[e]}))},onMessage(e){if(!(!Ot.test(e.origin)&&!It.test(e.origin))){if(e.data.type==="COPILOT_SETUP"){u=e.origin;return}if(e.data.type==="COPILOT_ROUTE_CHANGE"&&h){h=!1,this.sendMessage();return}e.data.type==="COPILOT_MOUNTED"&&this.updateSubPosition(this.sub_position)}},onChromeMessage(e){if(e.action===j.OpenSidePanel){if(e.data.type==="uploadfile"&&(this.showOverlay=!0),e.data.type==="uploadfilefinish"&&(this.showOverlay=!1,+e.data.result.code==0)){const{link_id:t,name:o,fname:s,size:l,fsize:a,file_id:C,file_name:r,file_size:O}=e.data.result.data,g=o||s||r;if(this.attachFile(t||C,g,l||a||O),g&&g.indexOf(".")>-1){const _=`filetype_${g.substring(g.lastIndexOf(".")+1).toLowerCase()}`;I("plugin_sidebar",{action:"click",element:_})}}if(this.searchText=e.data.text,this.quoteText=e.data.quote,this.isWebpagesum=e.data.route==="webpagesum",this.isWebpagesum&&(e.data.route=x.chat),this.action===e.data.route){this.sendMessage();return}h=!0,this.onClick(e.data.route)}},async sendMessage(){if(h)return;if(this.isWebpagesum){this.isWebpagesum=!1;const t=await K(),o=t==null?void 0:t.url;if(!o)return;const s=y("COPILOT_CHAT_START",{text:o+`
总结页面内容`,type:""});this.iframe.contentWindow.postMessage(s,u);return}if(this.sendQuoteMessage(this.quoteText),this.quoteText="",this.sendFile){const t=y("COPILOT_INPUTBOX_FILL",this.sendFile);this.iframe.contentWindow.postMessage(t,u),this.sendFile=null;return}if(this.searchText===null||this.searchText===void 0||this.searchText==="")return;const e=y("COPILOT_CHAT_START",{text:decodeURIComponent(this.searchText),type:"explain"});this.iframe.contentWindow.postMessage(e,u)},sendQuoteMessage(e){if(e==null||e==="")return;const t=y("COPILOT_INPUTBOX_TEXT_QUOTE",decodeURIComponent(e));this.iframe.contentWindow.postMessage(t,u)},attachFile(e,t,o){if(h){this.sendFile={id:e,name:t,size:o};return}const s=y("COPILOT_INPUTBOX_FILL",{id:e,name:t,size:o});this.iframe.contentWindow.postMessage(s,u)},goSetting(){const t=`${w.getURL("/index.html")}#/options`;w.createTabs({url:t}),I("plugin_sidebar",{action:"click",element:"setting"})},updateSubPosition(e){if(!e)return;const t=y("COPILOT_CONFIG",e);this.iframe.contentWindow.postMessage(t,u)},reSetPage(){const e="height: 100%; width: 100%; overflow: hidden; margin: 0; padding: 0;";document.getElementsByTagName("html")[0].style.cssText=e,document.getElementsByTagName("body")[0].style.cssText=e,document.getElementById("app").style.cssText=e},onLingxiFail(){this.lingxi_fail=!0},onretryIframe(){const e=this.iframe.src;this.iframe.src="",h=!0,this.lingxi_fail=!1,this.iframe.src=e,this.handleInitIframeFail()},handleInitIframeFail(){setTimeout(()=>{h&&(this.lingxi_fail=!0)},10*1e3)}},async mounted(){this.reSetPage(),I("plugin_sidebar",{action:"show"});const e=new $,t="jumpfrom=wps_browser_extension&customDomainDisabled=true";let o=u+`/?${t}`;const s=JSON.parse(await e.getItem("send_to_side_panel_data")||JSON.stringify({text:"",route:x.chat}));this.searchText=s.text,this.quoteText=s.quote,this.isWebpagesum=s.route==="webpagesum",this.isWebpagesum&&(s.route=x.chat),s.route&&(this.action=s.route,o=`${u+A[this.action]}?${t}`),s.chatId&&(this.searchText="",this.quoteText="",o=`${u}/chat/${s.chatId}?wd=${s.text}&${t}`),this.sub_position=s.sub_position,s.type==="uploadfile"&&(this.showOverlay=!0),this.iframe=document.getElementById("lingxi_iframe"),window.addEventListener("message",this.onMessage.bind(this),!1),this.url=o,this.handleInitIframeFail(),w.addListener(this.onChromeMessage.bind(this))}},bt={class:"sidepanel"},xt={key:0,class:"overlay"},kt={class:"loading"},Lt=["src"],Pt={class:"lingxi-fail"},St={class:"right"};function Mt(e,t,o,s,l,a){const C=et("AdBanner");return P(),L(at,null,[i("div",bt,[l.showOverlay?(P(),L("div",xt,[i("div",kt,[d(c,{size:"20",class:"loading-icon"},{default:f(()=>t[10]||(t[10]=[m("$IconFileLoading")])),_:1,__:[10]}),t[11]||(t[11]=i("span",null,"文档加载中，请稍后",-1))])])):H("",!0),i("iframe",{id:"lingxi_iframe",class:"left",src:l.url},null,8,Lt),it(i("div",Pt,[t[12]||(t[12]=i("div",{class:"lingxi-fail-icon"},[i("img",{src:_t})],-1)),t[13]||(t[13]=i("div",{class:"lingxi-fail-text"},[i("span",null,"加载失败,请重试")],-1)),i("div",{class:"lingxi-fail-btn",onClick:t[0]||(t[0]=nt((...r)=>a.onretryIframe&&a.onretryIframe(...r),["stop","prevent"]))},"重试")],512),[[st,l.lingxi_fail]]),i("div",St,[i("div",{class:v([{active:l.action==="chat"},"item"]),onClick:t[1]||(t[1]=r=>a.onClick("chat",!0))},[d(c,{size:"16"},{default:f(()=>t[14]||(t[14]=[m("$IconChat")])),_:1,__:[14]}),t[15]||(t[15]=i("span",null,"问答",-1))],2),i("div",{class:v([{active:l.action==="creative"},"item"]),onClick:t[2]||(t[2]=r=>a.onClick("creative",!0))},[d(c,{size:"16"},{default:f(()=>t[16]||(t[16]=[m("$IconCreative")])),_:1,__:[16]}),t[17]||(t[17]=i("span",null,"写作",-1))],2),i("div",{class:v([{active:l.action==="ppt"},"item"]),onClick:t[3]||(t[3]=r=>a.onClick("ppt",!0))},[d(c,{size:"16"},{default:f(()=>t[18]||(t[18]=[m("$IconPpt")])),_:1,__:[18]}),t[19]||(t[19]=i("span",null,"PPT",-1))],2),i("div",{class:v([{active:l.action==="search"},"item"]),onClick:t[4]||(t[4]=r=>a.onClick("search",!0))},[d(c,{size:"16"},{default:f(()=>t[20]||(t[20]=[m("$IconSideSearch")])),_:1,__:[20]}),t[21]||(t[21]=i("span",null,"搜索",-1))],2),i("div",{class:v([{active:l.action==="read"},"item"]),onClick:t[5]||(t[5]=r=>a.onClick("read",!0))},[d(c,{size:"16"},{default:f(()=>t[22]||(t[22]=[m("$IconRead")])),_:1,__:[22]}),t[23]||(t[23]=i("span",null,"阅读",-1))],2),i("div",{class:v([{active:l.action==="history"},"item"]),onClick:t[6]||(t[6]=r=>a.onClick("history",!0))},[d(c,{size:"16"},{default:f(()=>t[24]||(t[24]=[m("$IconHistory")])),_:1,__:[24]}),t[25]||(t[25]=i("span",null,"历史",-1))],2),i("div",{class:v([{active:l.action==="favorite"},"item"]),onClick:t[7]||(t[7]=r=>a.onClick("favorite",!0))},[d(c,{size:"16"},{default:f(()=>t[26]||(t[26]=[m("$IconFavorite")])),_:1,__:[26]}),t[27]||(t[27]=i("span",null,"收藏",-1))],2),i("div",{class:"item",onClick:t[8]||(t[8]=r=>a.onClick("protal",!0))},[d(c,{size:"16"},{default:f(()=>t[28]||(t[28]=[m("$IconProtal")])),_:1,__:[28]}),t[29]||(t[29]=i("span",null,"更多",-1))]),t[32]||(t[32]=i("div",{class:"last"},null,-1)),i("div",{class:"item",onClick:t[9]||(t[9]=r=>a.goSetting())},[d(c,{size:"16"},{default:f(()=>t[30]||(t[30]=[m("$IconSideSetting")])),_:1,__:[30]}),t[31]||(t[31]=i("span",null,"设置",-1))])])]),d(C)],64)}const Rt=W(wt,[["render",Mt],["__scopeId","data-v-8f93ed52"]]);export{Rt as default};
